<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="-1" />
<!--
   Note to customizers: the body of the webrev is IDed as SUNWwebrev
   to allow easy overriding by users of webrev via the userContent.css
   mechanism available in some browsers.

   For example, to have all "removed" information be red instead of
   brown, set a rule in your userContent.css file like:

       body#SUNWwebrev span.removed { color: red ! important; }
-->
<style type="text/css" media="screen">
body {
    background-color: #eeeeee;
}
hr {
    border: none 0;
    border-top: 1px solid #aaa;
    height: 1px;
}
div.summary {
    font-size: .8em;
    border-bottom: 1px solid #aaa;
    padding-left: 1em;
    padding-right: 1em;
}
div.summary h2 {
    margin-bottom: 0.3em;
}
div.summary table th {
    text-align: right;
    vertical-align: top;
    white-space: nowrap;
}
span.lineschanged {
    font-size: 0.7em;
}
span.oldmarker {
    color: red;
    font-size: large;
    font-weight: bold;
}
span.newmarker {
    color: green;
    font-size: large;
    font-weight: bold;
}
span.removed {
    color: brown;
}
span.changed {
    color: blue;
}
span.new {
    color: blue;
    font-weight: bold;
}
a.print { font-size: x-small; }

</style>

<style type="text/css" media="print">
pre { font-size: 0.8em; font-family: courier, monospace; }
span.removed { color: #444; font-style: italic }
span.changed { font-weight: bold; }
span.new { font-weight: bold; }
span.newmarker { font-size: 1.2em; font-weight: bold; }
span.oldmarker { font-size: 1.2em; font-weight: bold; }
a.print {display: none}
hr { border: none 0; border-top: 1px solid #aaa; height: 1px; }
</style>

<title>jdk10-hotspot-hg Sdiff src/cpu/ppc/vm </title>
</head><body id="SUNWwebrev">
<center><a href='../../../../src/cpu/ppc/vm/assembler_ppc.inline.hpp.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../index.html' target='_top'>index</a> <a href='../../../../src/cpu/ppc/vm/macroAssembler_ppc.hpp.sdiff.html' target='_top'>next &gt</a></center>
<h2>src/cpu/ppc/vm/macroAssembler_ppc.cpp</h2>
<a class="print" href="javascript:print()">Print this page</a>
<pre>rev <a href="https://bugs.openjdk.java.net/browse/JDK-13010">13010</a> : PPC: Implement MulAdd and SquareToLen intrinsics

This implementation is based on the algorithm implemented in java. It
yields a performance speedup of:
JDK8 - 23%
JDK9 - 5%
JDK10 - 5%</pre>

<table><tr valign="top">
<td><pre>

</pre><hr></hr><pre>
5199   blt(CCR0, L_post_third_loop_done);
5200 
5201   sldi(tmp, idx, LogBytesPerInt);
5202   lwzx(yz_idx, y, tmp);
5203   multiply64(product_high, product, x_xstart, yz_idx);
5204   lwzx(yz_idx, z, tmp);
5205 
5206   add2_with_carry(product_high, product, yz_idx, carry);
5207 
5208   sldi(tmp, idx, LogBytesPerInt);
5209   stwx(product, z, tmp);
5210   srdi(product, product, 32);
5211 
5212   sldi(product_high, product_high, 32);
5213   orr(product, product, product_high);
5214   mr_if_needed(carry, product);
5215 
5216   bind(L_post_third_loop_done);
5217 }   // multiply_128_x_128_loop
5218 


































5219 void MacroAssembler::multiply_to_len(Register x, Register xlen,
5220                                      Register y, Register ylen,
5221                                      Register z, Register zlen,
5222                                      Register tmp1, Register tmp2,
5223                                      Register tmp3, Register tmp4,
5224                                      Register tmp5, Register tmp6,
5225                                      Register tmp7, Register tmp8,
5226                                      Register tmp9, Register tmp10,
5227                                      Register tmp11, Register tmp12,
5228                                      Register tmp13) {
5229 
5230   ShortBranchVerifier sbv(this);
5231 
5232   assert_different_registers(x, xlen, y, ylen, z, zlen,
5233                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp6);
5234   assert_different_registers(x, xlen, y, ylen, z, zlen,
5235                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp7);
5236   assert_different_registers(x, xlen, y, ylen, z, zlen,
5237                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp8);
5238 

</pre><hr></hr>
</pre></td><td><pre>

</pre><hr></hr><pre>
5199   blt(CCR0, L_post_third_loop_done);
5200 
5201   sldi(tmp, idx, LogBytesPerInt);
5202   lwzx(yz_idx, y, tmp);
5203   multiply64(product_high, product, x_xstart, yz_idx);
5204   lwzx(yz_idx, z, tmp);
5205 
5206   add2_with_carry(product_high, product, yz_idx, carry);
5207 
5208   sldi(tmp, idx, LogBytesPerInt);
5209   stwx(product, z, tmp);
5210   srdi(product, product, 32);
5211 
5212   sldi(product_high, product_high, 32);
5213   orr(product, product, product_high);
5214   mr_if_needed(carry, product);
5215 
5216   bind(L_post_third_loop_done);
5217 }   // multiply_128_x_128_loop
5218 
<span class="new">5219 void MacroAssembler::muladd(Register out, Register in,</span>
<span class="new">5220                             Register offset, Register len, Register k,</span>
<span class="new">5221                             Register tmp1, Register tmp2, Register carry) {</span>
<span class="new">5222 </span>
<span class="new">5223     // Labels</span>
<span class="new">5224     Label LOOP, SKIP;</span>
<span class="new">5225 </span>
<span class="new">5226     // Make sure length is positive.</span>
<span class="new">5227     cmpdi  (CCR0,    len,     0);</span>
<span class="new">5228 </span>
<span class="new">5229     // Prepare variables</span>
<span class="new">5230     subi   (offset,  offset,  4);</span>
<span class="new">5231     li     (carry,   0);</span>
<span class="new">5232     ble    (CCR0,    SKIP);</span>
<span class="new">5233 </span>
<span class="new">5234     mtctr  (len);</span>
<span class="new">5235     subi   (len,     len,     1    );</span>
<span class="new">5236     sldi   (len,     len,     2    );</span>
<span class="new">5237 </span>
<span class="new">5238     // Main loop</span>
<span class="new">5239     bind(LOOP);</span>
<span class="new">5240     lwzx   (tmp1,    len,     in   );</span>
<span class="new">5241     lwzx   (tmp2,    offset,  out  );</span>
<span class="new">5242     mulld  (tmp1,    tmp1,    k    );</span>
<span class="new">5243     add    (tmp2,    carry,   tmp2 );</span>
<span class="new">5244     add    (tmp2,    tmp1,    tmp2 );</span>
<span class="new">5245     stwx   (tmp2,    offset,  out  );</span>
<span class="new">5246     srdi   (carry,   tmp2,    32   );</span>
<span class="new">5247     subi   (offset,  offset,  4    );</span>
<span class="new">5248     subi   (len,     len,     4    );</span>
<span class="new">5249     bdnz   (LOOP);</span>
<span class="new">5250     bind(SKIP);</span>
<span class="new">5251 }</span>
<span class="new">5252 </span>
5253 void MacroAssembler::multiply_to_len(Register x, Register xlen,
5254                                      Register y, Register ylen,
5255                                      Register z, Register zlen,
5256                                      Register tmp1, Register tmp2,
5257                                      Register tmp3, Register tmp4,
5258                                      Register tmp5, Register tmp6,
5259                                      Register tmp7, Register tmp8,
5260                                      Register tmp9, Register tmp10,
5261                                      Register tmp11, Register tmp12,
5262                                      Register tmp13) {
5263 
5264   ShortBranchVerifier sbv(this);
5265 
5266   assert_different_registers(x, xlen, y, ylen, z, zlen,
5267                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp6);
5268   assert_different_registers(x, xlen, y, ylen, z, zlen,
5269                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp7);
5270   assert_different_registers(x, xlen, y, ylen, z, zlen,
5271                              tmp1, tmp2, tmp3, tmp4, tmp5, tmp8);
5272 

</pre><hr></hr>
</pre></td>
</tr></table>
<center><a href='../../../../src/cpu/ppc/vm/assembler_ppc.inline.hpp.sdiff.html' target='_top'>&lt prev</a> <a href='../../../../index.html' target='_top'>index</a> <a href='../../../../src/cpu/ppc/vm/macroAssembler_ppc.hpp.sdiff.html' target='_top'>next &gt</a></center>
</body></html>
